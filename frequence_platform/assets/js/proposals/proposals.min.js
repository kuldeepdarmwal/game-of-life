jQuery(function(a){function b(b){a("#proposal").fadeTo(200,0),a("#proposal").height(0);var d="null"===b?"":"?template="+b;a("#proposal").attr("src",e+"/html/"+d),a("#proposal").load(function(b){b.stopImmediatePropagation(),c(),a("main, #proposal").height(a("#proposal").contents().outerHeight()),a("#proposal").fadeTo(200,1)})}function c(){var b=a("main").width(),c=a("#proposal").contents().find(".page").outerWidth(),d=b/(c+50);if(d>=1)return a("#proposal").contents().find("body").css({transform:"none",width:"100%"}),!0;a("#proposal").contents().find("body").width(c),a("#proposal").contents().find("body").css("transform","scale("+d+")"),a("#proposal").contents().find("body").css("-webkit-transform-origin","0 0");var e=(b-a("#proposal").contents().find("body").width()*d)/2;a("#proposal").contents().find("html").css("padding-left",e)}a("input").placeholder(),a("#proposal").fadeTo(0,0),a("select").material_select(),a(".modal-trigger").leanModal(),a(".button-collapse").sideNav();var d=a("input#proposal_id").val(),e="/proposals/"+d;b(a("#template option:first").val()),a(document).on("change","#template",function(c){c.stopPropagation(),b(value=a(this).val())}),a(window).resize(function(a){c()}),a("#save_proposal_html").on("click",function(b){b.preventDefault(),a.ajax({url:"/proposals/"+d+"/save_html",method:"POST",dataType:"json",data:{html:a("#proposal").contents().find("html").html(),proposal_id:d,base_template:a("#template").val()},success:function(b){a("#template").val(a("#template option:first").val()),Materialize.toast("Template Saved",4e3)},error:function(a){Materialize.toast(a.responseText,5e3)}})}),a("#template_upload").submit(function(c){c.preventDefault(),a.ajax({url:a(this).attr("action"),type:a(this).attr("method"),data:new FormData(this),dataType:"json",processData:!1,contentType:!1,success:function(c){b(c.id),0==a('#template optgroup option[value="'+c.id+'"]').length&&a("#template optgroup").append(a("<option></option>").attr("value",c.id).text(c.filename.replace("templates/",""))),a("#template").val(c.id),a("#modal1").closeModal(),a("#template_upload").trigger("reset")},error:function(b){Materialize.toast(b.responseText,5e3),a("input.file-path").addClass("invalid")}})})});