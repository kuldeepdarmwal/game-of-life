window.frqVidAd=function(){function a(a){var b,c,d,e,f;for(f={},b=a.split("&"),c=0,d=b.length;d>c;c++)e=b[c].split("="),f[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return f}function b(a,b){var c;if(a&&b)for(c in a)void 0===b[c]&&(b[c]=a[c]);return b||a}function c(a){return function(b){var c,d=""+a;for(c in b)("string"==typeof b[c]||"number"==typeof b[c])&&(d=d.replace(new RegExp("{{"+c+"}}","g"),b[c]));return d=d.replace(/{{[^}]+}}/g,"")}}function d(a,b){var c;for(c in b)"string"==typeof b[c]&&(a.style[c]=b[c])}function e(a,b,c){var d={};return d.className=a.className.trim(),d.classList=d.className?a.className.trim().split(/\s+/):[],d.classIndex=d.classList.indexOf(b),d.hasClass=-1!==d.classIndex,c?d:d.hasClass}function f(a,b,c){var d,f,g,h=0;for(b=b.trim().split(/\s+/),h=0,d=b.length;d>h;h++)f=b[h],g=e(a,f,!0),void 0===c?c=!0:null===c&&(c=!g.hasClass),c&&!g.hasClass?g.classList.push(f):!c&&g.hasClass&&g.classList.splice(g.classIndex,1);a.className=g.classList.join(" ")}function g(a,b,c){var d,e;for(b=b.trim().split(/\s+/),d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c)}function h(a,b,c){var d,e;for(b=b.trim().split(/\s+/),d=0,e=b.length;e>d;d++)a.removeEventListener(b[d],c)}function i(a,b,c,d){var e,d;d=d||"mouseover",a.addEventListener(d,function(a){e?(clearTimeout(e),e=null):b.apply(a.target,[a])}),a.addEventListener("mouseout",function(a){e=setTimeout(function(){c.apply(a.target,[a])},0)})}function j(a,b,c){"boolean"!=typeof c||c?a.setAttribute(b,c):a.hasAttribute(b)&&a.removeAttribute(b)}function k(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function l(a,b,c,e,f,g,h){this.element=document.createElement("DIV"),this.imageElement=document.createElement("DIV"),this.element.appendChild(this.imageElement),g=g||0,h=h||0,d(this.element,{width:b+"px",height:c+"px",padding:h+"px "+g+"px"}),d(this.imageElement,{"background-image":"url("+a+")","background-repeat":"no-repeat","background-position":"-"+e+"px -"+f+"px",width:b+"px",height:c+"px"}),this.offsetStates={},this.setOffset=function(a,b){d(this.imageElement,{"background-position":"-"+(e+a)+"px -"+(f+b)+"px"})},this.defineState=function(a,b,c){this.offsetStates[a]={x:b,y:c}},this.setState=function(a){this.offsetStates[a]&&this.setOffset(this.offsetStates[a].x,this.offsetStates[a].y)}}function m(){this.listeners={}}function n(a,c){m.call(this);var d;if(this.defaults=b({propagatedEvents:[]},this.defaults),this.ad=a,this.options=b(this.defaults,c),this.element=this.build(),this.options.id&&(this.element.id=this.options.id),this.options.events)for(d in this.options.events)this.addEventListener(d,this.options.events[d]);this.bubbleFrom(this.element,this.options.propagatedEvents),this.options.parent&&this.options.parent.appendChild(this.element)}function o(){this.defaults={explicitNaturalWidth:!0},n.apply(this,arguments)}function p(){this.defaults={explicitNaturalWidth:!0,propagatedEvents:["click","mouseover","mouseout"]},n.apply(this,arguments)}function q(){this.defaults={text:"",styles:{}},n.apply(this,arguments),this.setText(this.options.text),this.setStyles(this.options.styles)}function r(){this.defaults={controls:!0,autoplay:!0,autoMute:!0,unmuteMessage:"click for audio",autoplayDuration:15,volume:1,preload:!0,mp4:null,webm:null,poster:null,propagatedEvents:["pause","canplay"]},n.apply(this,arguments),this.volume=1,this.options.autoMute&&this.toggleMute(!0),this.options.autoplay&&this.toggleOpen(!0)}function s(a){var b,c;return b=Math.floor(a/60).toString(),c=Math.floor(a%60).toString(),c.length<2&&(c="0"+c),b+":"+c}function t(){var a,b,c=this;this.defaults={video:null,showReplay:!0,showVolume:!0,showTime:!0,visibleAtStart:!1,alwaysVisible:!1,timeout:2e3,spritesUrl:"https://ed18a41e851d21bd3d3b-2105a7941d639194e8ba5253efec10c9.ssl.cf1.rackcdn.com/automated_video_ads/assets/video_control_sprites.png",spriteSize:30},n.apply(this,arguments),this.options.video.element.appendChild(this.element),this.isVisible=!0,this.options.visibleAtStart||this.options.alwaysVisible?this.show(this.options.alwaysVisible):this.hide(),this.options.alwaysVisible||(a=function(){c.show()},b=function(){c.hide()},i(this.options.video.element,a,b,"mousemove"),g(this.options.video.element,"mousedown click touchstart touchend",a))}function u(e,f){var h,i=this;this.container=e,this.config=b(a(this.container.getAttribute("data-init")),f),this.config.id=this.container.getAttribute("id"),h=c(this.config.layout),this.container.innerHTML=h(this.config),d(this.container,{width:this.config.w-2*this.config.bw+"px",height:this.config.h-2*this.config.bw+"px",border:this.config.bw+"px solid #"+this.config.bc}),g(this.container,this.clickThroughEvents,function(a){i.clickThrough()}),this.build()}return m.prototype.addEventListener=function(a,b){this.listeners.hasOwnProperty(a)||(this.listeners[a]=[]),this.listeners[a].push(b)},m.prototype.createEvent=function(a,b){return{type:a,target:this,data:b}},m.prototype.dispatchEvent=function(a,b){var c,d;if("string"==typeof a&&(a=this.createEvent(a,b)),"object"==typeof this.listeners[a.type])for(c=0,d=this.listeners[a.type].length;d>c;c++)this.listeners[a.type][c].apply(this,[a])},m.prototype.removeEventListener=function(a,b){var c;for(c=this.listeners[a].length-1;c>-1;c--)b===this.listeners[a][c]&&this.listeners[a].splice(c,1)},m.prototype.bubbleFrom=function(a,b){var c,d,e,f=this;for(c=function(a){f.dispatchEvent(a)},d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c)},n.prototype=new m,n.prototype.constructor=n,n.prototype.build=function(){return document.createElement("DIV")},o.prototype=new n,o.prototype.constructor=o,o.prototype.build=function(){var a,b,c=this;return b=new Image,b.addEventListener("load",function(){c.width=this.width,c.height=this.height,c.options.explicitNaturalWidth&&(c.element.width=c.width,c.element.height=c.height),c.dispatchEvent("load")}),b.src=this.options.src,a=new Image,a.src=this.options.src,a},p.prototype=new n,p.prototype.constructor=p,p.prototype.build=function(){var a,b,c,e=this,g=0;return a=document.createElement("DIV"),f(a,this.ad.config.id+"_hover_wrap"),d(a,{visibility:"hidden"}),b=function(){g++,g===e.images.length&&e.dispatchEvent("load")},this.addEventListener("load",function(){d(this.element,{visibility:""}),this.images[0].options.explicitNaturalWidth&&(this.width=this.images[0].width,this.height=this.images[0].height,d(this.element,{width:this.width+"px",height:this.height+"px"}))}),c={load:b},this.images=[new o(this.ad,{src:this.options.idle,parent:a,explicitNaturalWidth:this.options.explicitNaturalWidth,events:c}),new o(this.ad,{src:this.options.hover,parent:a,explicitNaturalWidth:this.options.explicitNaturalWidth,events:c})],a},q.prototype=new n,q.prototype.constructor=q,q.prototype.setText=function(a){this.element.innerHTML=a},q.prototype.setStyles=function(a){d(this.element,a)},r.prototype=new n,r.prototype.constructor=r,r.statusEvents="progress pause playing timeupdate ended volumechange",r.intentionalUserEvents="mousedown mouseup click touchstart touchend",r.otherUserEvents="mousemove keydown keypress keyup",r.prototype.build=function(){var a,b,c;return a=this,b=document.getElementById(this.ad.config.id+"_video_wrap"),this.element=b,this.videoElement=document.createElement("VIDEO"),this.videoElement.id=this.ad.config.id+"_video",b.appendChild(this.videoElement),f(b,"loading"),j(this.videoElement,"controls",!1),j(this.videoElement,"preload",this.options.preload),j(this.videoElement,"autoplay",this.options.autoplay),g(this.videoElement,r.statusEvents,function(b){return a.onStatusChange(b),!0}),this.videoElement.addEventListener("canplay",function(b){a.firstReady(b)}),this.firstUserInteractionHandler=function(b){a.firstUserInteraction(b)},g(b,r.intentionalUserEvents,this.firstUserInteractionHandler),g(b,this.ad.clickThroughEvents,function(b){b.target!==a.videoElement&&a.ad.cancelClickThrough()}),c=[],this.options.webm&&c.push({mimeType:"video/webm",src:this.options.webm}),this.options.mp4&&c.push({mimeType:"video/mp4",src:this.options.mp4}),this.load(c),this.ad.config.video.show_poster&&this.options.poster&&(this.poster=new o(this.ad,{id:this.ad.config.id+"_video_poster",src:this.options.poster,parent:b})),this.ad.config.play_button&&(this.playButton=new p(this.ad,{parent:b,id:this.ad.config.id+"_play_btn",idle:this.ad.config.play_button.idle,hover:this.ad.config.play_button.hover,events:{click:function(){a.toggleOpen(!0),a.play()},load:function(){d(this.element,{marginLeft:"-"+this.width/2+"px",marginTop:"-"+this.height/2+"px"})}}})),this.options.autoMute&&this.options.unmuteMessage?this.unmuteText=new q(this.ad,{parent:b,text:this.options.unmuteMessage,styles:{"font-family":"sans-serif",color:"white",position:"absolute","font-size":"20px","text-shadow":"0 0.1em 0.2em black",top:"60%",width:"100%","text-align":"center"}}):this.unmuteText=null,this.controls=new t(this.ad,{video:this}),b.appendChild(this.controls.element),b},r.prototype.load=function(a){var b,c;for(k(this.videoElement),c=0;c<a.length;c++)"string"==typeof a[c].mimeType&&(b=document.createElement("SOURCE"),b.setAttribute("type",a[c].mimeType),b.setAttribute("src",a[c].src),this.videoElement.appendChild(b))},r.prototype.toggleOpen=function(a){var b;b=void 0!==a?a:!this.isOpen(),this.noteAnim(this.element,this.ad.config.dur),f(this.element,"open",b)},r.prototype.noteAnim=function(a,b){f(a,"anim-done",!1),clearTimeout(this.noteAnimTimeout),this.noteAnimTimeout=setTimeout(function(){f(a,"anim-done")},1e3*b)},r.prototype.isOpen=function(){return e(this.element,"open")},r.prototype.firstReady=function(){var a=this;this.ready||(this.ready=!0,f(this.element,"loading",!1),this.options.autoplay&&this.options.autoplayDuration&&(this.autoPauseTimeout=setTimeout(function(){a.autoPause()},1e3*this.options.autoplayDuration)))},r.prototype.firstUserInteraction=function(a){var b=this;this.userHasInteracted||(this.userHasInteracted=!0,h(this.element,r.intentionalUserEvents,this.firstUserInteractionHandler),a.stopImmediatePropagation(),this.options.autoplay&&this.options.autoplayDuration&&this.seek(0),this.autoPauseTimeout&&clearTimeout(this.autoPauseTimeout),this.options.autoMute&&(this.disablingAutoMute=!0,setTimeout(function(){b.disablingAutoMute=!1},500),this.toggleMute(!1)),this.dispatchEvent("first-user-interaction",a))},r.prototype.autoPause=function(){this.pause(),this.toggleMute(!1)},r.prototype.onStatusChange=function(a){this.paused!==this.videoElement.paused&&(this.paused=this.videoElement.paused,this.noteAnim(this.element,this.ad.config.dur),f(this.element,"paused",this.paused)),"ended"===a.type&&this.toggleOpen(!1),"volumechange"===a.type&&this.unmuteText&&(this.unmuteText.setStyles({display:this.isMuted()?"block":"none"}),this.isMuted()||(this.unmuteText=null)),this.currentTime=this.videoElement.currentTime},r.prototype.play=function(){this.videoElement.play()},r.prototype.pause=function(){this.videoElement.pause()},r.prototype.seek=function(a){return this.videoElement.currentTime=a,this.videoElement.currentTime},r.prototype.toggleMute=function(a){return this.videoElement.muted=void 0!==a?a:!this.isMuted(),this.isMuted()},r.prototype.isMuted=function(){return this.videoElement.muted},t.prototype=new n,t.prototype.constructor=t,t.prototype.build=function(){this.element=document.createElement("DIV");var a="30px";return d(this.element,{position:"absolute",left:"0",bottom:"0",color:"white",width:"100%",height:a,"line-height":a,"background-color":"rgba(0,0,0,0.5)","text-align":"center","font-size":"12px"}),this.play=this.createPlayButton(this),this.time=this.createTimeDisplay(this),this.volume=this.createVolumeControl(this),d(this.play.element,{position:"absolute",width:a,height:a,left:"4px",bottom:"0"}),d(this.time.element,{position:"absolute",height:a,right:"40px",bottom:"0","text-align":"right"}),d(this.volume.element,{position:"absolute",width:a,height:a,right:"4px",bottom:"0"}),this.element},t.prototype.createGenericControl=function(a,b){var c={};return b?(c.sprite=b,c.element=b.element):c.element=document.createElement("DIV"),a.element.appendChild(c.element),c},t.prototype.createPlayButton=function(a){var b,c,d;return b=this,c=new l(this.options.spritesUrl,this.options.spriteSize,this.options.spriteSize,0,0),d=this.createGenericControl(a,c),d.sprite.defineState("paused",0,0),d.sprite.defineState("playing",1*this.options.spriteSize,0),d.sprite.defineState("ended",2*this.options.spriteSize,0),d.setState=function(a){a!==d.state&&(d.state=a,d.sprite.setState(a))},d.setState("paused"),this.options.video.videoElement.addEventListener("pause",function(){d.setState("paused")}),this.options.video.videoElement.addEventListener("playing",function(){d.setState("playing")}),this.options.video.videoElement.addEventListener("ended",function(){d.setState("ended")}),d.element.addEventListener("click",function(){switch(d.state){case"paused":b.options.video.play();break;case"ended":b.options.video.toggleOpen(!0),setTimeout(function(){b.options.video.play()},10);default:b.options.video.pause()}}),d},t.prototype.createTimeDisplay=function(a){var b=this.createGenericControl(a);return b.duration=0,b.update=function(a,c){var d=s(a);void 0!==c&&(this.duration=c),d+=" / "+s(this.duration),b.element.innerHTML=d},b.update(0),this.options.video.videoElement.addEventListener("timeupdate",function(a){b.update(a.target.currentTime,a.target.duration)}),b},t.prototype.createVolumeControl=function(a){var b=this;return sprite=new l(this.options.spritesUrl,this.options.spriteSize,this.options.spriteSize,3*this.options.spriteSize,0),control=this.createGenericControl(a,sprite),control.sprite.defineState("mute",0,0),control.sprite.defineState("sound",1*this.options.spriteSize,0),control.update=function(a){void 0===a&&(a=b.options.video.isMuted()),control.sprite.setState(a?"mute":"sound")},control.update(b.options.video.options.autoMute),control.element.addEventListener("click",function(a){b.options.video.disablingAutoMute||(b.options.video.toggleMute(),control.update())}),b.options.video.videoElement.addEventListener("volumechange",function(){control.update()}),control},t.prototype.show=function(a){var b=this;clearTimeout(this.timeoutId),this.isVisible||(this.element.style.display="block"),a!==!0&&(this.timeoutId=setTimeout(function(){b.hide()},this.options.timeout)),this.isVisible=!0},t.prototype.hide=function(){clearTimeout(this.timeoutId),this.isVisible&&(this.isVisible=!1,this.element.style.display="none")},u.prototype=new m,u.prototype.constructor=u,u.prototype.version="0.2.2",u.prototype.clickThroughEvents="click touchend",u.prototype.build=function(){var a;a=this,this.config.hasOwnProperty("video")&&(this.video=new r(this,{poster:this.config.video.poster,mp4:this.config.video.mp4,webm:this.config.video.webm}))},u.prototype.clickThrough=function(){var a=this;this.config.advertiser_url&&!this.cancelNextClickThrough&&(this.clickThroughTimeout=setTimeout(function(){window.open(a.config.advertiser_url),a.clickThroughTimeout=null},0))},u.prototype.cancelClickThrough=function(){var a=this;this.clickThroughTimeout?clearTimeout(this.clickThroughTimeout):(this.cancelNextClickThrough=!0,clearTimeout(this.cancelClickThroughTimeout),this.cancelClickThroughTimeout=setTimeout(function(){a.cancelNextClickThrough=!1},1))},u}();