{"version":3,"sources":["components/proposal-builder/proposal.ts"],"names":[],"mappings":"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","file":"components/proposal-builder/proposal.js","sourcesContent":["import {Component, ViewChildren, QueryList, HostListener, OnInit, Inject} from 'angular2/core';\nimport {HTTP_PROVIDERS}    from 'angular2/http';\n\nimport {MaterializeDirective} from 'angular2-materialize';\n\nimport {PageView} from './page';\nimport {NewPageView} from './new-page';\nimport {PageModel, PageService} from '../../services/page';\nimport {ProposalService} from '../../services/proposal';\nimport {ConfigService} from '../../services/config';\n\nimport {OrderBy} from '../../utils/orderby';\n\n@Component({\n    selector: 'proposal',\n    templateUrl: '/public/app/components/proposal-builder/proposal.html?v=<%= VERSION %>',\n    pipes: [OrderBy],\n    directives: [PageView, NewPageView, MaterializeDirective],\n    providers: [\n    \tHTTP_PROVIDERS,\n    \tProposalService,\n    \tPageModel,\n    \tPageService\n    ]\n})\nexport class Proposal {\n    pages: PageModel[];\n    proposal: Object;\n    private insertWeight: number;\n\n    @ViewChildren(PageView)\n    _pageView: QueryList<PageView>;\n\n    constructor (private _proposalService: ProposalService, private _pageService: PageService, @Inject(ConfigService) private config) { }\n\n    ngAfterViewInit() {\n    \tthis.getProposal();\n    }\n\n    getProposal() {\n    \tthis._proposalService.getProposal()\n    \t\t.subscribe((proposal) => {\n                this.proposal = proposal.json();\n                this.getPages();\n    \t\t});\n    }\n\n    getPages() {\n    \tthis._pageService.getPages()\n    \t\t.subscribe(pages => {\n    \t\t\tthis.pages = pages;\n    \t\t});\n    }\n\n    addPage(template: PageModel) {\n    \tvar weight = this.insertWeight + 1; // insert after the button we clicked\n\t\tthis._pageService.addPage(weight, template.id)\n\t\t\t.subscribe(page => {\n\t\t\t\tthis.pages.splice(weight, 0, page);\n\t\t\t\tthis.sortPages();\n\t\t\t});\n\t}\n\n\tremovePage(page: PageModel) {\n        this._pageService.removePage(page.id)\n            .subscribe(res => {\n        \t\tfor (var i = 0; i < this.pages.length; i++) {\n        \t\t\tif (this.pages[i].id === page.id) {\n        \t\t\t\tthis.pages.splice(i, 1);\n        \t\t\t}\n        \t\t}\n        \t\tthis.sortPages();\n            });\n\t}\n\n\tsortPages() {\n\t\tfor (var i = 0; i < this.pages.length; i++) {\n\t\t\tthis.pages[i].weight = i;\n\t\t}\n\t}\n\n\tpageTrackBy(index:number, page:PageModel) {\n\t\treturn page.id;\n\t}\n\n    setInsertWeight(weight) {\n        this.insertWeight = weight;\n        this.resizeWindow();\n    }\n\n    resizeWindow() {\n        var timeout = window.setInterval(function() {\n            if (document.querySelector('#new-page-form page-frame').offsetHeight > 0) {\n                clearInterval(timeout);\n            }\n            window.dispatchEvent(new Event('resize')); // opens the page frames in the modal\n        }, 50);\n    }\n}"],"sourceRoot":"/source/"}